<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minimal web-application based on T4 framework</title>
  {{ publishCss() }}
    <link href="{{ asset('/Layouts/simplePagination.css') }}" rel="stylesheet">

</head>
<body>
<nav class="navbar navbar-fixed-top">
    <div class="container">
        <ul class="nav  navbar-nav">
            <li>
                <a  class="nav-link" href="//jsondoc" >На главную</a>
            </li>
            <li>
                <a  class="nav-link" href="" onclick="return newdoc();">Создать новый документ</a>
            </li>
        </ul>
        <ul id="userlogin" class="nav navbar-right navbar-nav">

        </ul>

    </div>
</nav>

<section></section>

{{ publishJs() }}
<script src="{{ asset('/Layouts/jquery.simplePagination.js')}}"></script>
<script type="text/javascript">

    function edit(id){
        $('section').load('//jsondoc/Edit?id='+id,function(response, status){
            if(status=='error'){
                $('section').html(response)


            }
        })
        return false
    }


    function list(page) {
        $('section').load('http://jsondoc/List?='+page, function(){
            $.get('//jsondoc/GetList.json?='+page, function(result){
                $('#light-pagination').pagination('updateItems', result.items.properties.pagination.required[0].total)
                $('#light-pagination').pagination('updateItemsOnPage', result.items.properties.pagination.required[0].perPage);
                refreshmenu(result);
                $('#light-pagination').pagination('selectPage', result.items.properties.pagination.required[0].page);
            })


        });

    }


    function call(){
        $.post('//jsondoc/Login.json',$('#login').serializeArray(),function (result) {

            if(result.login_err)
                $('#validlogin').html(result.login_err)
            else
                refreshmenu(result)
        })
        return false
    }


    function refreshmenu(result)
    {
        if (!result.user) {
            $('#userlogin').html('   <li class="dropdown">' +
                    '<a href="#" class="dropdown-toggle" data-toggle="dropdown">Вход </a>' +
                    '<ul class="dropdown-menu">' +
                    '<h3 class="text-center" style="color: black"></h3>' +
                    '<form role="form" id="login" action="javascript:void(null);" onsubmit="call()" style="padding: 15px">' +
                    '<div class="form-group">' +
                    '<p id="validlogin" style="color: #9b0000"></p>' +
                    '<div class="input-group">' +
                    '<span class="input-group-addon"><i class="glyphicon glyphicon-login"></i></span>' +
                    '<input type="text" placeholder="login" class="form-control input-sm" name="login" value="" "></div><br>' +

                    '<div class="form-group">' +
                    '<button type="submit" class="btn btn-theme-bg pull-right" style="background-color: #77CCDD">' +
                    '<i class="glyphicon glyphicon-share"></i>Войти</button>' +
                    '</div> <a href="#myModal" role="button" data-toggle="modal" style="color: #9b0000; background-color: inherit">Забыли пароль?</a>' +
                    '<div class="clearfix"></div><hr></div></form></ul></li>');

        } else {
            $('#userlogin').html(
                    '<li><a href="/user/logout" data-toggle="tooltip" title="Выход">Вы вошли как: '+result.user+'  &nbsp;&nbsp;<span' +
                    'class="glyphicon glyphicon-log-out"></span></a></li>')

        }

    }







    $(function() {

        list(1)

        $('section').on('click','button', function(){edit($(this).val())})
        $('#light-pagination').pagination('onPageClick',alert('click'))


    })






</script>
</body>
</html>