<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minimal web-application based on T4 framework</title>
  {{ publishCss() }}
    <link href="{{ asset('/Layouts/simplePagination.css') }}" rel="stylesheet">

</head>
<body>
<nav class="navbar navbar-fixed-top">
    <div class="container">
        <ul class="nav  navbar-nav">
            <li>
                <a  class="nav-link" href="//jsondoc" >На главную</a>
            </li>
            <li>
                <a  class="nav-link" href="" onclick="return newdoc();">Создать новый документ</a>
            </li>
        </ul>
        <ul id="userlogin" class="nav navbar-right navbar-nav">

        </ul>

    </div>
</nav>

<section>


</section>





{{ publishJs() }}
<script src="{{ asset('/Layouts/jquery.simplePagination.js')}}"></script>
<script type="text/javascript">

    function list(page) {
         var list=$.get('http://jsondoc/List.json?page='+page);
    }


    function call(){
        request('//jsondoc/Login.json','post',$('#call').serializeArray());
        return false

    }

    function body(result){
        $('section').append($("<div>").load('http://jsondoc/ShablonList #title'));

        $.each(result.items.properties.document.items.document, function (key, val) {
            $('section').append($('<div>').load('http://jsondoc/ShablonList #body'))
        })

        $('section').append($('<div>').load('http://jsondoc/ShablonList #footer',function() {

            $('#light-pagination').pagination({

                cssStyle: 'light-theme'
            })
            $('#light-pagination').pagination('updateItems', result.items.properties.pagination.required[0].total)
            $('#light-pagination').pagination('updateItemsOnPage', result.items.properties.pagination.required[0].perPage);

        }))


    }

    function puginator(result) {



    }





    function request(url, type, data) {
        $.when($.ajax({
            url: url,
            type: type,
            data: data

        }).then(function (result) {

            if(result.user['err'])
              $('#validlogin').html(result.user['err'])


        }))}


    function refreshmenu(result)
    {


        if (!result.user['user']) {
            $('#userlogin').html('   <li class="dropdown">' +
                    '<a href="#" class="dropdown-toggle" data-toggle="dropdown">Вход </a>' +
                    '<ul class="dropdown-menu">' +
                    '<h3 class="text-center" style="color: black"></h3>' +
                    '<form role="form" id="call" action="javascript:void(null);" onsubmit="call()" style="padding: 15px">' +
                    '<div class="form-group">' +
                    '<p id="validlogin" style="color: #9b0000"></p>' +
                    '<div class="input-group">' +
                    '<span class="input-group-addon"><i class="glyphicon glyphicon-login"></i></span>' +
                    '<input type="text" placeholder="login" class="form-control input-sm" name="login" value="" id="login"></div><br>' +

                    '<div class="form-group">' +
                    '<button type="submit" class="btn btn-theme-bg pull-right" style="background-color: #77CCDD">' +
                    '<i class="glyphicon glyphicon-share"></i>Войти</button>' +
                    '</div> <a href="#myModal" role="button" data-toggle="modal" style="color: #9b0000; background-color: inherit">Забыли пароль?</a>' +
                    '<div class="clearfix"></div><hr></div></form></ul></li>');

        } else {
            $('#userlogin').html(
                    '<li><a href="/user/logout" data-toggle="tooltip" title="Выход">Вы вошли как: '+result.user['user']+'  &nbsp;&nbsp;<span' +
                    'class="glyphicon glyphicon-log-out"></span></a></li>')

        }



    }







    $(function() {

        //$('section').load('http://jsondoc/ShablonList');

        // list('http://jsondoc/List.json?page=1')

        list(1)['list'].done(function (result) {
            if (result.user['err'])
                $('#validlogin').html(result.user['err'])
            else {
                   body(result)
                refreshmenu(result)
            }
        });

        //list()





    })






</script>
</body>
</html>